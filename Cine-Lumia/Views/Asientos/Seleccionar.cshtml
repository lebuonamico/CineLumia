@using Cine_Lumia.Models.ViewModel
@model SeleccionAsientosViewModel

<h2>@Model.SalaNombre - Seleccionar Asiento</h2>

<style>
    .asiento {
        width: 35px;
        height: 35px;
        margin: 3px;
        border-radius: 6px;
        display: inline-flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        border: 1px solid #555;
        font-size: 14px;
    }

    .libre {
        background: #7DFF7D;
    }

    .ocupado {
        background: #FF7777;
        cursor: not-allowed;
    }

    .seleccionado {
        background: #40A3FF;
    }
</style>

<div>
    @foreach (var fila in Model.Asientos.GroupBy(a => a.Fila))
    {
        <div>
            @foreach (var asiento in fila)
            {
                <div class="asiento @(asiento.Ocupado ? "ocupado" : "libre")"
                     data-id="@asiento.IdAsiento"
                     onclick="seleccionarAsiento(this)">
                    @asiento.Fila@asiento.Columna
                </div>
            }
        </div>
    }
</div>

<button id="confirmarBtn" style="margin-top:20px; display:none;" onclick="confirmar()">Confirmar</button>

<script>
    let seleccionados = [];

    function seleccionarAsiento(el) {
        if (el.classList.contains("ocupado")) return;

        let id = el.dataset.id;

        if (seleccionados.includes(id)) {
            seleccionados = seleccionados.filter(x => x !== id);
            el.classList.remove("seleccionado");
        } else {
            seleccionados.push(id);
            el.classList.add("seleccionado");
        }

        document.getElementById("confirmarBtn").style.display = seleccionados.length > 0 ? "block" : "none";
    }

    function confirmar() {
        let lista = seleccionados.join(",");
        window.location = "/Entradas/Confirmar?proyeccionId=@Model.IdProyeccion&asientos=" + lista;
    }
</script>
