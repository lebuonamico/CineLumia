<style>
    body {
        padding-top: 90px; /* ajustá según la altura real de tu navbar */
    }
</style>
<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Cine_Lumia</title>
    <script type="importmap"></script>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <!-- Añadido para los iconos de Bootstrap.. -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/Cine_Lumia.styles.css" asp-append-version="true" />
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-sm navbar-toggleable-sm navbar-dark border-bottom box-shadow mb-3 fixed-top navegador-l">
            <div class="container-fluid">
                <a class="navbar-brand" asp-area="" asp-controller="Home" asp-action="Index">
                    <img src="~/img/cine.png" alt="CineLumia" style="width: 225px;" />
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".navbar-collapse" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="navbar-collapse collapse d-sm-inline-flex justify-content-between">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link text-light" asp-area="" asp-controller="Home" asp-action="Index">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-light" asp-area="" asp-controller="Peliculas" asp-action="Index">Películas</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-light" asp-area="" asp-controller="Consumibles" asp-action="Index">Snacks</a>
                        </li>
                    </ul>
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link text-light" href="#" data-bs-toggle="offcanvas" data-bs-target="#offcanvasCines" aria-controls="offcanvasCines">Seleccionar Cine</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle text-light" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                @if (User.Identity.IsAuthenticated)
                                {
                                    <span>Hola, @User.Identity.Name</span>
                                }
                                else
                                {
                                    <span>Cuenta</span>
                                }
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                                @if (User.Identity.IsAuthenticated)
                                {
                                    <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#profileModal">Ver Perfil</a></li>
                                    <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#manageAccountModal">Gestionar Cuenta</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" asp-controller="Account" asp-action="Logout">Cerrar Sesión</a></li>
                                }
                                else
                                {
                                    <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#loginModal">Login</a></li>
                                    <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#registerModal">Registrarse</a></li>
                                }
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <div class="container">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>

<!-- Inicio de Modales de Cuenta -->
<!-- Modal de Login -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">Iniciar Sesión</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form asp-controller="Account" asp-action="Login" method="post">
                    <div class="text-danger mb-3 validation-summary-errors"></div>
                    
                    <div class="form-floating mb-3">
                        <input type="text" id="LoginIdentifier" name="LoginIdentifier" class="form-control" placeholder="Mail" />
                        <label for="LoginIdentifier">Mail</label>
                        <span class="text-danger field-validation-valid" data-valmsg-for="LoginIdentifier" data-valmsg-replace="true"></span>
                    </div>
                    
                    <div class="form-floating mb-3">
                        <div class="input-group">
                            <input type="password" id="passwordInputModal" name="Password" class="form-control" placeholder="Contraseña" />
                            <label for="passwordInputModal">Contraseña</label>
                            <button class="btn btn-outline-secondary" type="button" id="togglePasswordModal">
                                <i class="bi bi-eye-slash" id="togglePasswordIconModal"></i>
                            </button>
                        </div>
                        <span class="text-danger field-validation-valid" data-valmsg-for="Password" data-valmsg-replace="true"></span>
                    </div>

                    <div class="mb-3 form-check">
                        <input type="checkbox" id="RememberMe" name="RememberMe" class="form-check-input" />
                        <label class="form-check-label" for="RememberMe">Recordarme</label>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">Ingresar</button>
                    </div>
                    <div class="text-center mt-3">
                        <a href="#" data-bs-toggle="modal" data-bs-target="#forgotPasswordModal" data-bs-dismiss="modal">¿Olvidaste tu contraseña?</a>
                    </div>
                    <div class="text-center mt-2">
                        <a href="#" data-bs-toggle="modal" data-bs-target="#registerModal" data-bs-dismiss="modal">¿No tenés cuenta? Registrate aquí</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Registro -->
<div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="registerModalLabel">Registrarse</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form asp-controller="Account" asp-action="Register" method="post">
                    <div class="text-danger mb-3 validation-summary-errors"></div>

                    <div class="mb-3">
                        <input type="text" id="Nombre" name="Nombre" class="form-control" placeholder="Nombre" />
                        <span class="text-danger field-validation-valid" data-valmsg-for="Nombre" data-valmsg-replace="true"></span>
                    </div>

                    <div class="mb-3">
                        <input type="text" id="Apellido" name="Apellido" class="form-control" placeholder="Apellido" />
                        <span class="text-danger field-validation-valid" data-valmsg-for="Apellido" data-valmsg-replace="true"></span>
                    </div>
                    
                    <div class="mb-3">
                        <input type="email" id="Email" name="Email" class="form-control" placeholder="Correo Electrónico" />
                        <span class="text-danger field-validation-valid" data-valmsg-for="Email" data-valmsg-replace="true"></span>
                    </div>
                    
                    <div class="mb-3">
                        <input type="password" id="Password" name="Password" class="form-control" placeholder="Contraseña" />
                        <span class="text-danger field-validation-valid" data-valmsg-for="Password" data-valmsg-replace="true"></span>
                    </div>

                    <div class="mb-3">
                        <input type="password" id="ConfirmPassword" name="ConfirmPassword" class="form-control" placeholder="Confirmar Contraseña" />
                        <span class="text-danger field-validation-valid" data-valmsg-for="ConfirmPassword" data-valmsg-replace="true"></span>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">Registrarse</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Perfil -->
<div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="profileModalLabel">Mi Perfil</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <div class="d-flex align-items-center justify-content-center mb-3 profile-info-container">
                    <!-- Avatar will be loaded dynamically or from a default -->
                    <img src="/img/avatar/default.png" alt="Avatar" class="profile-avatar-small me-3" style="width: 40px; height: 40px; border-radius: 50%;">
                    <div>
                        <p class="mb-0"><strong>Correo Electrónico:</strong> <span id="profileEmail"></span></p>
                        <p class="mb-0"><strong>Alias:</strong> <span id="profileAlias"></span></p>
                    </div>
                </div>
                <p class="mt-4">Desde aquí puedes administrar los detalles de tu cuenta.</p>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#manageAccountModal" data-bs-dismiss="modal">Gestionar Cuenta</button>
                <a asp-controller="Account" asp-action="Logout" class="btn btn-danger mt-3">Cerrar Sesión</a>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Gestionar Cuenta -->
<div class="modal fade" id="manageAccountModal" tabindex="-1" aria-labelledby="manageAccountModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="manageAccountModalLabel">Gestionar Cuenta</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="d-flex align-items-center justify-content-center mb-4">
                    <div class="avatar-carousel">
                        <button id="prev-avatar-modal" type="button" class="avatar-nav-btn prev"><i class="bi bi-arrow-left-circle"></i></button>
                        <img src="/img/avatar/default.png" alt="Avatar" class="profile-avatar" id="avatar-image-modal">
                        <button id="next-avatar-modal" type="button" class="avatar-nav-btn next"><i class="bi bi-arrow-right-circle"></i></button>
                    </div>
                </div>

                <form asp-controller="Account" asp-action="Manage" method="post">
                    <input type="hidden" id="IdAvatarModal" name="IdAvatar" value="" />
                    <div class="text-danger mb-3 validation-summary-errors"></div>

                    <h4 class="mb-3">Datos Personales</h4>
                    <div class="mb-3">
                        <label for="Nombre" class="form-label">Nombre</label>
                        <input type="text" id="Nombre" name="Nombre" class="form-control" />
                        <span class="text-danger field-validation-valid" data-valmsg-for="Nombre" data-valmsg-replace="true"></span>
                    </div>
                    <div class="mb-3">
                        <label for="Apellido" class="form-label">Apellido</label>
                        <input type="text" id="Apellido" name="Apellido" class="form-control" />
                        <span class="text-danger field-validation-valid" data-valmsg-for="Apellido" data-valmsg-replace="true"></span>
                    </div>
                    <div class="mb-3">
                        <label for="Email" class="form-label">Email</label>
                        <input type="email" id="Email" name="Email" class="form-control" />
                        <span class="text-danger field-validation-valid" data-valmsg-for="Email" data-valmsg-replace="true"></span>
                    </div>
                    <div class="mb-3">
                        <label for="Dni" class="form-label">Dni</label>
                        <input type="text" id="Dni" name="Dni" class="form-control" />
                        <span class="text-danger field-validation-valid" data-valmsg-for="Dni" data-valmsg-replace="true"></span>
                    </div>
                    <div class="mb-3">
                        <label for="Alias" class="form-label">Alias</label>
                        <input type="text" id="Alias" name="Alias" class="form-control" />
                        <span class="text-danger field-validation-valid" data-valmsg-for="Alias" data-valmsg-replace="true"></span>
                    </div>
                    <div class="mb-3">
                        <label for="Telefono" class="form-label">Telefono</label>
                        <input type="text" id="Telefono" name="Telefono" class="form-control" />
                        <span class="text-danger field-validation-valid" data-valmsg-for="Telefono" data-valmsg-replace="true"></span>
                    </div>
                    <div class="mb-3">
                        <label for="FechaNacimiento" class="form-label">FechaNacimiento</label>
                        <input type="date" id="FechaNacimiento" name="FechaNacimiento" class="form-control" />
                        <span class="text-danger field-validation-valid" data-valmsg-for="FechaNacimiento" data-valmsg-replace="true"></span>
                    </div>
                    <div class="mb-3">
                        <label for="Genero" class="form-label">Genero</label>
                        <select id="Genero" name="Genero" class="form-select">
                            <option value="">Seleccionar Género</option>
                            <option value="Hombre">Hombre</option>
                            <option value="Mujer">Mujer</option>
                            <option value="Otro">Otro</option>
                        </select>
                        <span class="text-danger field-validation-valid" data-valmsg-for="Genero" data-valmsg-replace="true"></span>
                    </div>

                    <hr class="my-4" />

                    <h4 class="mb-3">Seguridad y Acceso</h4>
                    <div class="d-flex justify-content-between mb-3">
                        <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#changePasswordModal" data-bs-dismiss="modal">Cambiar Contraseña</button>
                        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">Eliminar Cuenta</button>
                    </div>

                    <hr class="my-4" />

                    <h4 class="mb-3">Métodos de Pago Guardados</h4>
                    <div class="mb-3">
                        <p class="text-muted">Aquí podrás ver y modificar tus tarjetas registradas. (Funcionalidad futura)</p>
                        <button type="button" class="btn btn-outline-info" disabled>Gestionar Tarjetas</button>
                    </div>

                    <hr class="my-4" />

                    <h4 class="mb-3">Historial y Configuración de Entradas</h4>
                    <div class="mb-3">
                        <p class="text-muted">Consulta tu historial de compras de entradas. (Funcionalidad futura)</p>
                        <button type="button" class="btn btn-outline-info" disabled>Ver Historial de Compras</button>
                    </div>

                    <hr class="my-4" />
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Olvidé mi Contraseña -->
<div class="modal fade" id="forgotPasswordModal" tabindex="-1" aria-labelledby="forgotPasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="forgotPasswordModalLabel">Olvidé mi Contraseña</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="card-text text-center">Ingresa tu correo electrónico y te enviaremos un enlace para restablecer tu contraseña.</p>
                <form asp-controller="Account" asp-action="ForgotPassword" method="post">
                    <div class="text-danger mb-3 validation-summary-errors"></div>
                    
                    <div class="form-floating mb-3">
                        <input type="email" id="Email" name="Email" class="form-control" placeholder="name@example.com" />
                        <label for="Email">Email</label>
                        <span class="text-danger field-validation-valid" data-valmsg-for="Email" data-valmsg-replace="true"></span>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">Enviar Enlace de Recuperación</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Cambiar Contraseña -->
<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="changePasswordModalLabel">Cambiar Contraseña</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form asp-controller="Account" asp-action="ChangePassword" method="post">
                    <div class="text-danger mb-3 validation-summary-errors"></div>

                    <div class="form-floating mb-3">
                        <input type="password" id="OldPassword" name="OldPassword" class="form-control" />
                        <label for="OldPassword">OldPassword</label>
                        <span class="text-danger field-validation-valid" data-valmsg-for="OldPassword" data-valmsg-replace="true"></span>
                    </div>

                    <div class="form-floating mb-3">
                        <input type="password" id="NewPassword" name="NewPassword" class="form-control" />
                        <label for="NewPassword">NewPassword</label>
                        <span class="text-danger field-validation-valid" data-valmsg-for="NewPassword" data-valmsg-replace="true"></span>
                    </div>

                    <div class="form-floating mb-3">
                        <input type="password" id="ConfirmPassword" name="ConfirmPassword" class="form-control" />
                        <label for="ConfirmPassword">ConfirmPassword</label>
                        <span class="text-danger field-validation-valid" data-valmsg-for="ConfirmPassword" data-valmsg-replace="true"></span>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">Cambiar Contraseña</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Confirmación de Olvido de Contraseña -->
<div class="modal fade" id="forgotPasswordConfirmationModal" tabindex="-1" aria-labelledby="forgotPasswordConfirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="forgotPasswordConfirmationModalLabel">Confirmación de Olvido de Contraseña</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <p>Si existe una cuenta con el correo electrónico que ingresaste, hemos enviado un enlace para restablecer tu contraseña.</p>
                <p>Por favor, revisa tu bandeja de entrada.</p>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#loginModal" data-bs-dismiss="modal">Volver a Iniciar Sesión</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Account Modal (ya existente en Manage.cshtml, se mueve aquí para centralizar) -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteAccountModalLabel">Confirmar Eliminación de Cuenta</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form asp-controller="Account" asp-action="DeleteAccountConfirmed" method="post">
                <div class="modal-body">
                    <p class="text-danger text-center">¡Advertencia! Esta acción es irreversible. Al eliminar tu cuenta, se borrarán todos tus datos.</p>
                    <div class="text-danger mb-3 validation-summary-errors"></div>

                    <div class="mb-3">
                        <label for="Password" class="form-label">Contraseña</label>
                        <input type="password" id="Password" name="Password" class="form-control" required />
                        <span class="text-danger field-validation-valid" data-valmsg-for="Password" data-valmsg-replace="true"></span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-danger">Confirmar Eliminación</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- Fin de Modales de Cuenta -->

<!-- Panel lateral (offcanvas) -->
<div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="offcanvasCines" aria-labelledby="offcanvasCinesLabel">
    <div class="offcanvas-header border-bottom">
        <h5 class="offcanvas-title fw-bold" id="offcanvasCinesLabel">Elegí tu cine principal</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
    </div>

    <div class="offcanvas-body d-flex flex-column justify-content-between">
        <!-- Contenedor donde se cargan los cines -->
        <div id="listaCines" class="mb-3">
            <div class="text-secondary small mb-3">Ordenado alfabéticamente</div>
            <!-- Acá se insertan los cines dinámicamente -->
        </div>

        <!-- Botón inferior -->
        <div class="mt-4 border-top pt-3 text-end">
            <button class="btn btn-danger px-4" id="btnSeleccionar" data-bs-dismiss="offcanvas">Seleccionar</button>
        </div>
    </div>
</div>

<!-- Script para cargar dinámicamente los cines -->
<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const contenedor = document.getElementById('listaCines');

        try {
            const response = await fetch('/Cines/Listar');
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const cines = await response.json();

            if (cines.length === 0) {
                contenedor.innerHTML = '<p class="text-info">No hay cines disponibles.</p>';
                return;
            }

            contenedor.innerHTML = cines.map(c => `
                <div class="list-group-item bg-dark text-light d-flex justify-content-between align-items-start border-0 py-3">
                    <div>
                        <div class="fw-semibold">${c.nombre}</div>
                        <small class="text-secondary">${c.direccion}</small>
                        
                    </div>
                    <input type="radio" name="cine" value="${c.id}" class="form-check-input bg-secondary border-0">
                </div>
            `).join('');

        } catch (error) {
            console.error('Error al cargar los cines:', error);
            contenedor.innerHTML = `<p class="text-danger">Error al cargar los cines: ${error.message}</p>`;
        }
    });

    document.getElementById('btnSeleccionar').addEventListener('click', () => {
        const seleccionado = document.querySelector('input[name="cine"]:checked');
        if (seleccionado) {
            alert(`Seleccionaste el cine con ID ${seleccionado.value}`);
            // Si querés redirigir:
            // window.location.href = `/Cines/Detalle/${seleccionado.value}`;
        } else {
            alert('Por favor seleccioná un cine.');
            // Handle form submission for Login
            const loginModal = document.getElementById('loginModal');
            if (loginModal) {
                const loginForm = loginModal.querySelector('form');
                if (loginForm) {
                    loginForm.addEventListener('submit', async function (event) {
                        event.preventDefault(); // Prevent default form submission

                        const formData = new FormData(loginForm);
                        const response = await fetch(loginForm.action, {
                            method: loginForm.method,
                            body: formData,
                            headers: {
                                'RequestVerificationToken': loginForm.querySelector('input[name="__RequestVerificationToken"]').value
                            }
                        });

                        const result = await response.json();

                        if (result.success) {
                            Swal.fire('Éxito', 'Inicio de sesión exitoso.', 'success').then(() => {
                                window.location.href = result.redirectUrl; // Redirect on success
                            });
                        } else {
                            // Display validation errors
                            let errorMessages = '';
                            if (result.message) {
                                errorMessages += `<p>${result.message}</p>`;
                            }
                            if (result.errors) {
                                for (const key in result.errors) {
                                    if (result.errors.hasOwnProperty(key)) {
                                        for (const errorArray of result.errors[key]) {
                                            errorArray.forEach(error => {
                                                errorMessages += `<p>${error}</p>`;
                                            });
                                        }
                                    }
                                }
                            }
                            Swal.fire('Error', errorMessages || 'Credenciales incorrectas.', 'error');
                        }
                    });
                }
            }
        }
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Password Toggle for Login Modal
        const togglePasswordModal = document.getElementById('togglePasswordModal');
        const passwordInputModal = document.getElementById('passwordInputModal');
        const togglePasswordIconModal = document.getElementById('togglePasswordIconModal');

        if (togglePasswordModal && passwordInputModal && togglePasswordIconModal) {
            togglePasswordModal.addEventListener('click', function () {
                const type = passwordInputModal.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInputModal.setAttribute('type', type);
                
                if (type === 'password') {
                    togglePasswordIconModal.classList.remove('bi-eye');
                    togglePasswordIconModal.classList.add('bi-eye-slash');
                } else {
                    togglePasswordIconModal.classList.remove('bi-eye-slash');
                    togglePasswordIconModal.classList.add('bi-eye');
                }
            });
        }

        // Profile Modal Data Loading
        const profileModal = document.getElementById('profileModal');
        if (profileModal) {
            profileModal.addEventListener('show.bs.modal', async function () {
                try {
                    const response = await fetch('/Account/GetProfileData');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    document.getElementById('profileEmail').textContent = data.email;
                    document.getElementById('profileAlias').textContent = data.alias || 'No asignado';
                    // Assuming avatar filenames are like AV001.gif, AV002.gif etc.
                    document.querySelector('#profileModal img').src = `/img/avatar/${data.avatars[data.idAvatar - 1]}`;
                } catch (error) {
                    console.error('Error loading profile data:', error);
                    // Optionally display an error message in the modal
                }
            });
        }

        // Manage Account Modal Data Loading and Avatar Carousel
        const manageAccountModal = document.getElementById('manageAccountModal');
        if (manageAccountModal) {
            const avatarImageModal = document.getElementById('avatar-image-modal');
            const prevButtonModal = document.getElementById('prev-avatar-modal');
            const nextButtonModal = document.getElementById('next-avatar-modal');
            const idAvatarInputModal = document.getElementById('IdAvatarModal');

            let avatars = []; // Will be populated from server
            let currentAvatarIndex = 0; // Will be populated from server

            function updateAvatarModal() {
                if (avatarImageModal && idAvatarInputModal && avatars.length > 0) {
                    avatarImageModal.src = `/img/avatar/${avatars[currentAvatarIndex]}`;
                    idAvatarInputModal.value = currentAvatarIndex + 1;
                }
            }

            if (prevButtonModal && nextButtonModal) {
                prevButtonModal.addEventListener('click', function () {
                    currentAvatarIndex = (currentAvatarIndex - 1 + avatars.length) % avatars.length;
                    updateAvatarModal();
                });

                nextButtonModal.addEventListener('click', function () {
                    currentAvatarIndex = (currentAvatarIndex + 1) % avatars.length;
                    updateAvatarModal();
                });
            }

            manageAccountModal.addEventListener('show.bs.modal', async function () {
                try {
                    const response = await fetch('/Account/GetManageData');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();

                    // Populate form fields
                    document.getElementById('Nombre').value = data.nombre || '';
                    document.getElementById('Apellido').value = data.apellido || '';
                    document.getElementById('Email').value = data.email || '';
                    document.getElementById('Dni').value = data.dni || '';
                    document.getElementById('Alias').value = data.alias || '';
                    document.getElementById('Telefono').value = data.telefono || '';
                    document.getElementById('FechaNacimiento').value = data.fechaNacimiento ? new Date(data.fechaNacimiento).toISOString().split('T')[0] : '';
                    document.getElementById('Genero').value = data.genero || '';

                    // Populate avatar data
                    avatars = data.avatars;
                    currentAvatarIndex = data.idAvatar - 1; // Adjust to 0-based index
                    updateAvatarModal();

                } catch (error) {
                    console.error('Error loading manage account data:', error);
                    // Optionally display an error message in the modal
                }
            });

            // Handle form submission for Manage Account
            const manageForm = manageAccountModal.querySelector('form');
            if (manageForm) {
                manageForm.addEventListener('submit', async function (event) {
                    event.preventDefault(); // Prevent default form submission

                    const formData = new FormData(manageForm);
                    const response = await fetch(manageForm.action, {
                        method: manageForm.method,
                        body: formData,
                        headers: {
                            'RequestVerificationToken': manageForm.querySelector('input[name="__RequestVerificationToken"]').value
                        }
                    });

                    const result = await response.json();

                    if (result.success) {
                        Swal.fire('Éxito', result.message, 'success');
                        const manageModalInstance = bootstrap.Modal.getInstance(manageAccountModal);
                        if (manageModalInstance) {
                            manageModalInstance.hide(); // Close the modal on success
                        }
                        // Optionally, refresh profile data if profile modal is open or update UI
                    } else {
                        // Display validation errors
                        let errorMessages = '';
                        if (result.message) {
                            errorMessages += `<p>${result.message}</p>`;
                        }
                        if (result.errors) {
                            for (const key in result.errors) {
                                if (result.errors.hasOwnProperty(key)) {
                                    for (const errorArray of result.errors[key]) {
                                        errorArray.forEach(error => {
                                            errorMessages += `<p>${error}</p>`;
                                        });
                                    }
                                }
                            }
                        }
                        Swal.fire('Error', errorMessages || 'Ocurrió un error al guardar los cambios.', 'error');
                    }
                });
            }
        }
            // Handle form submission for Change Password
            const changePasswordModal = document.getElementById('changePasswordModal');
            if (changePasswordModal) {
                const changePasswordForm = changePasswordModal.querySelector('form');
                if (changePasswordForm) {
                    changePasswordForm.addEventListener('submit', async function (event) {
                        event.preventDefault(); // Prevent default form submission

                        const formData = new FormData(changePasswordForm);
                        const response = await fetch(changePasswordForm.action, {
                            method: changePasswordForm.method,
                            body: formData,
                            headers: {
                                'RequestVerificationToken': changePasswordForm.querySelector('input[name="__RequestVerificationToken"]').value
                            }
                        });

                        const result = await response.json();

                        if (result.success) {
                            Swal.fire('Éxito', result.message, 'success');
                            const changePasswordModalInstance = bootstrap.Modal.getInstance(changePasswordModal);
                            if (changePasswordModalInstance) {
                                changePasswordModalInstance.hide(); // Close the modal on success
                            }
                            // Optionally, refresh manage account data if manage modal is open or update UI
                        } else {
                            // Display validation errors
                            let errorMessages = '';
                            if (result.message) {
                                errorMessages += `<p>${result.message}</p>`;
                            }
                            if (result.errors) {
                                for (const key in result.errors) {
                                    if (result.errors.hasOwnProperty(key)) {
                                        for (const errorArray of result.errors[key]) {
                                            errorArray.forEach(error => {
                                                errorMessages += `<p>${error}</p>`;
                                            });
                                        }
                                    }
                                }
                            }
                            Swal.fire('Error', errorMessages || 'Ocurrió un error al cambiar la contraseña.', 'error');
                        }
                    });
                }
            }

    });
</script>

    <footer class="footer bg-dark text-white text-center py-3">
        <div class="container d-flex justify-content-center align-items-center">
            <p class="mb-0 me-3">&copy; 2025 - CineLumia - <a asp-area="" asp-controller="Home" asp-action="Privacy" class="text-white">Privacy</a></p>
            <div class="d-flex align-items-center">
                <span class="me-2">Siguenos:</span>
                <a href="#" class="text-white me-2"><i class="bi bi-facebook"></i></a>
                <a href="#" class="text-white me-2"><i class="bi bi-instagram"></i></a>
                <a href="#" class="text-white"><i class="bi bi-youtube"></i></a>
            </div>
        </div>
    </footer>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    @await RenderSectionAsync("Scripts", required: false)
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>